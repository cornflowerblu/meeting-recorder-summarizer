{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Transcript",
  "type": "object",
  "required": [
    "recording_id",
    "generated_at",
    "segments",
    "pipeline_version",
    "model_version"
  ],
  "properties": {
    "recording_id": { "type": "string" },
    "generated_at": {
      "type": "string",
      "format": "date-time",
      "description": "When transcript was generated"
    },
    "duration_ms": {
      "type": "integer",
      "minimum": 0,
      "description": "Total recording duration in milliseconds"
    },
    "total_segments": {
      "type": "integer",
      "description": "Number of transcript segments"
    },
    "speakers_detected": {
      "type": "integer",
      "description": "Number of unique speakers detected"
    },
    "segments": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "start_ms", "end_ms", "speaker_label", "text"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique segment ID (e.g., seg_001)"
          },
          "start_ms": { "type": "integer", "minimum": 0 },
          "end_ms": { "type": "integer", "minimum": 0 },
          "speaker_label": {
            "type": "string",
            "description": "Raw label from transcription (e.g., spk_0)"
          },
          "text": { "type": "string" },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "words": {
            "type": "array",
            "description": "Word-level timing for precise seeking",
            "items": {
              "type": "object",
              "required": ["word", "start_ms", "end_ms"],
              "properties": {
                "word": { "type": "string" },
                "start_ms": { "type": "integer", "minimum": 0 },
                "end_ms": { "type": "integer", "minimum": 0 },
                "confidence": { "type": "number", "minimum": 0, "maximum": 1 }
              }
            }
          }
        }
      }
    },
    "speaker_map": {
      "type": "object",
      "description": "Mapping from speaker labels to real names",
      "additionalProperties": {
        "type": "object",
        "required": ["name"],
        "properties": {
          "name": { "type": "string" },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "AI mapping confidence (0-1)"
          },
          "manually_corrected": {
            "type": "boolean",
            "default": false,
            "description": "Whether user manually corrected this mapping"
          }
        }
      }
    },
    "redactions": {
      "type": "array",
      "description": "Time ranges to redact from display",
      "items": {
        "type": "object",
        "required": ["start_ms", "end_ms"],
        "properties": {
          "start_ms": { "type": "integer", "minimum": 0 },
          "end_ms": { "type": "integer", "minimum": 0 },
          "reason": {
            "type": "string",
            "description": "Why this segment was redacted"
          },
          "created_by": {
            "type": "string",
            "description": "User ID who created redaction"
          },
          "created_at": { "type": "string", "format": "date-time" }
        }
      }
    },
    "pipeline_version": {
      "type": "string",
      "description": "Processing pipeline version"
    },
    "model_version": {
      "type": "string",
      "description": "Transcription model version (e.g., amazon-transcribe-batch-v1)"
    }
  }
}
